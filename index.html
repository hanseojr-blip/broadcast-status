<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“» ë°©ì†¡ë¶€ ì‹¤ì‹œê°„ í˜„í™© - ì„¸ë¶€ ì‹œì„¤ë³„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }

        .status-connected {
            background: #27ae60;
            color: white;
        }

        .status-error {
            background: #e74c3c;
            color: white;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .date-input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .group-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #ddd;
            transition: all 0.3s ease;
        }

        .group-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .group-available {
            border-left-color: #95a5a6;
        }

        .group-applied {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);
        }

        .group-completed {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #e8f8f5 0%, #ffffff 100%);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .group-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .group-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-available {
            background: #ecf0f1;
            color: #7f8c8d;
        }

        .status-applied {
            background: #f39c12;
            color: white;
        }

        .status-completed {
            background: #27ae60;
            color: white;
        }

        .applicant {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .facilities-list {
            margin-top: 15px;
        }

        .facility-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 3px solid #ddd;
        }

        .facility-available {
            border-left-color: #95a5a6;
        }

        .facility-applied {
            border-left-color: #f39c12;
            background: #fff9e6;
        }

        .facility-completed {
            border-left-color: #27ae60;
            background: #e8f8f5;
        }

        .facility-name {
            font-weight: 500;
        }

        .facility-status {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .status-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .badge-good {
            background: #27ae60;
            color: white;
        }

        .badge-warning {
            background: #f39c12;
            color: white;
        }

        .badge-error {
            background: #e74c3c;
            color: white;
        }

        .badge-pending {
            background: #95a5a6;
            color: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .groups-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“» ë°©ì†¡ë¶€ ì‹¤ì‹œê°„ í˜„í™©</h1>
            <p>ì„¸ë¶€ ì‹œì„¤ë³„ ì ê²€ í˜„í™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”</p>
            <div id="connectionStatus" class="status-indicator status-error">
                ğŸ”„ ì—°ê²° í™•ì¸ ì¤‘...
            </div>
        </div>

        <div class="controls">
            <input type="date" id="dateInput" class="date-input">
            <button onclick="loadStatus()" class="btn btn-primary">í˜„í™© ì¡°íšŒ</button>
            <button onclick="window.open('https://forms.gle/YdxPsbDNCwyi1GNC9', '_blank')" class="btn btn-success">
                ğŸ“ ì‹ ì²­í•˜ê¸°
            </button>
            <button onclick="window.open('https://forms.gle/CV9uATrMgQ6sbWSu9', '_blank')" class="btn btn-success">
                âœ… ì ê²€ ì™„ë£Œ ë³´ê³ 
            </button>
        </div>

        <div id="loadingDiv" class="loading" style="display: none;">
            í˜„í™©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...
        </div>

        <div id="groupsContainer" class="groups-grid"></div>

        <div class="footer">
            <p>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span></p>
            <p>ğŸ”„ 15ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨</p>
        </div>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwmaWOiejYj-g0urKhvQc3ODG_P7bg2iWT8U7NgoJTKk2TPWrPPgu5-QS8fgGztYU9M/exec';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateInput').value = today;
            loadStatus();
            
            // 15ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
            setInterval(loadStatus, 15000);
        });

        async function loadStatus() {
            const dateInput = document.getElementById('dateInput');
            const loadingDiv = document.getElementById('loadingDiv');
            const groupsContainer = document.getElementById('groupsContainer');
            const connectionStatus = document.getElementById('connectionStatus');
            
            loadingDiv.style.display = 'block';
            groupsContainer.innerHTML = '';
            
            try {
                const response = await fetch(`${WEB_APP_URL}?date=${dateInput.value}`);
                const data = await response.json();
                
                if (data.success) {
                    connectionStatus.className = 'status-indicator status-connected';
                    connectionStatus.innerHTML = 'ğŸŸ¢ ì‹¤ì‹œê°„ ë°ì´í„° ì—°ê²°ë¨';
                    displayGroups(data.groups);
                    document.getElementById('lastUpdate').textContent = 
                        new Date(data.lastUpdate).toLocaleString('ko-KR');
                } else {
                    throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                connectionStatus.className = 'status-indicator status-error';
                connectionStatus.innerHTML = 'ğŸ”´ ì—°ê²° ì‹¤íŒ¨ - ì˜¤í”„ë¼ì¸ ëª¨ë“œ';
                displayOfflineGroups();
            }
            
            loadingDiv.style.display = 'none';
        }

        function displayGroups(groups) {
            const container = document.getElementById('groupsContainer');
            
            groups.forEach(group => {
                const groupCard = document.createElement('div');
                groupCard.className = `group-card group-${group.status}`;
                
                const facilitiesHTML = group.facilities.map(facility => {
                    let statusBadges = '';
                    
                    if (facility.checkResult) {
                        const volumeClass = getStatusClass(facility.checkResult.volume);
                        const qualityClass = getStatusClass(facility.checkResult.quality);
                        
                        statusBadges = `
                            <div class="facility-status">
                                <span class="status-badge badge-${volumeClass}">
                                    ${getVolumeIcon(facility.checkResult.volume)}
                                </span>
                                <span class="status-badge badge-${qualityClass}">
                                    ${getQualityIcon(facility.checkResult.quality)}
                                </span>
                            </div>
                        `;
                    } else {
                        statusBadges = `
                            <div class="facility-status">
                                <span class="status-badge badge-pending">
                                    ${facility.status === 'applied' ? 'ëŒ€ê¸°ì¤‘' : 'ë¯¸ì‹ ì²­'}
                                </span>
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="facility-item facility-${facility.status}">
                            <span class="facility-name">${facility.name}</span>
                            ${statusBadges}
                        </div>
                    `;
                }).join('');
                
                const statusText = {
                    'available': 'ì‹ ì²­ ê°€ëŠ¥',
                    'applied': 'ì ê²€ ëŒ€ê¸°ì¤‘',
                    'completed': 'ì ê²€ ì™„ë£Œ'
                };
                
                const applicantInfo = group.applicant ? 
                    `<div class="applicant">ë‹´ë‹¹: ${group.applicant}</div>` : '';
                
                groupCard.innerHTML = `
                    <div class="group-header">
                        <div class="group-name">${group.name}</div>
                        <div class="group-status status-${group.status}">
                            ${statusText[group.status]}
                        </div>
                    </div>
                    ${applicantInfo}
                    <div class="facilities-list">
                        <strong>ì„¸ë¶€ ì‹œì„¤ í˜„í™©:</strong>
                        ${facilitiesHTML}
                    </div>
                    ${group.status === 'available' ? `
                        <div class="action-buttons">
                            <button onclick="window.open('https://forms.gle/YdxPsbDNCwyi1GNC9', '_blank')" 
                                    class="btn btn-success">
                                ğŸ“ ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    ` : ''}
                    ${group.status === 'applied' ? `
                        <div class="action-buttons">
                            <button onclick="window.open('https://forms.gle/CV9uATrMgQ6sbWSu9', '_blank')" 
                                    class="btn btn-success">
                                âœ… ì ê²€ ì™„ë£Œ ë³´ê³ 
                            </button>
                        </div>
                    ` : ''}
                `;
                
                container.appendChild(groupCard);
            });
        }

        function getStatusClass(status) {
            if (status.includes('ì ì •') || status.includes('ì–‘í˜¸')) return 'good';
            if (status.includes('ì‹¬ê°í•œ ë¬¸ì œ') || status.includes('ì¡°ì ˆ ë¶ˆê°€')) return 'error';
            return 'warning';
        }

        function getVolumeIcon(volume) {
            if (volume.includes('ì ì •')) return 'ğŸ”Š';
            if (volume.includes('ë„ˆë¬´ í¼')) return 'ğŸ“¢';
            if (volume.includes('ë„ˆë¬´ ì‘ìŒ')) return 'ğŸ”‰';
            if (volume.includes('ì¡°ì ˆ ë¶ˆê°€')) return 'âš ï¸';
            return 'â“';
        }

        function getQualityIcon(quality) {
            if (quality.includes('ì–‘í˜¸')) return 'âœ…';
            if (quality.includes('ì•½ê°„ ë¬¸ì œ')) return 'âš ï¸';
            if (quality.includes('ì‹¬ê°í•œ ë¬¸ì œ')) return 'âŒ';
            return 'â“';
        }

        function displayOfflineGroups() {
            const container = document.getElementById('groupsContainer');
            
            const offlineGroups = [
                { id: '1ì¸µ', name: 'ğŸŸ¤ 1ì¸µ ì‹œì„¤', facilities: ['ìˆ˜ì—…ë‚˜ëˆ”ì¹´í˜', 'ë³´ê±´ì‹¤', 'ë¼ì˜¨ë°˜'] },
                { id: '2ì¸µ_1~4', name: 'ğŸŸ¦ 2ì¸µ ì‹œì„¤ (1í•™ë…„ 1~4ë°˜)', facilities: ['1í•™ë…„ 1ë°˜', '1í•™ë…„ 2ë°˜', '1í•™ë…„ 3ë°˜', '1í•™ë…„ 4ë°˜'] },
                { id: '2ì¸µ_5~8', name: 'ğŸŸ¢ 2ì¸µ ì‹œì„¤ (1í•™ë…„ 5~8ë°˜)', facilities: ['1í•™ë…„ 5ë°˜', '1í•™ë…„ 6ë°˜', '1í•™ë…„ 7ë°˜', '1í•™ë…„ 8ë°˜'] },
                { id: '3ì¸µ_1~4', name: 'ğŸŸ¨ 3ì¸µ ì‹œì„¤ (2í•™ë…„ 1~4ë°˜)', facilities: ['2í•™ë…„ 1ë°˜', '2í•™ë…„ 2ë°˜', '2í•™ë…„ 3ë°˜', '2í•™ë…„ 4ë°˜'] },
                { id: '3ì¸µ_5~8', name: 'ğŸŸª 3ì¸µ ì‹œì„¤ (2í•™ë…„ 5~8ë°˜)', facilities: ['2í•™ë…„ 5ë°˜', '2í•™ë…„ 6ë°˜', '2í•™ë…„ 7ë°˜', '2í•™ë…„ 8ë°˜'] },
                { id: '4ì¸µ', name: 'ğŸ”´ 4ì¸µ ì‹œì„¤', facilities: ['ê°•ë‹¹', 'í¸ì§‘ì‹¤', 'ê³¼í•™ì‹¤1'] },
                { id: 'ì‹ ê´€_3ì¸µ', name: 'ğŸŸ  ì‹ ê´€ 3ì¸µ ì‹œì„¤ (3í•™ë…„ 1~3ë°˜)', facilities: ['3í•™ë…„ 1ë°˜', '3í•™ë…„ 2ë°˜', '3í•™ë…„ 3ë°˜'] },
                { id: 'ë°©ì†¡ì‹¤', name: 'ğŸŸ£ ë°©ì†¡ì‹¤', facilities: ['ë°©ì†¡ì‹¤'] }
            ];
            
            offlineGroups.forEach(group => {
                const groupCard = document.createElement('div');
                groupCard.className = 'group-card group-available';
                
                // ë°©ì†¡ì‹¤ì€ ë‹¨ìˆœí•œ ì‹ ì²­ë§Œ ê°€ëŠ¥í•œ í˜•íƒœë¡œ í‘œì‹œ
                if (group.id === 'ë°©ì†¡ì‹¤') {
                    groupCard.innerHTML = `
                        <div class="group-header">
                            <div class="group-name">${group.name}</div>
                            <div class="group-status status-available">ì‹ ì²­ ê°€ëŠ¥</div>
                        </div>
                        <div class="facilities-list">
                            <strong>ë°©ì†¡ì‹¤ í˜„í™©:</strong>
                            <div class="facility-item facility-available">
                                <span class="facility-name">ë°©ì†¡ì‹¤ ì „ì²´</span>
                                <div class="facility-status">
                                    <span class="status-badge badge-pending">ì‚¬ìš© ê°€ëŠ¥</span>
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button onclick="window.open('https://forms.gle/YdxPsbDNCwyi1GNC9', '_blank')" 
                                    class="btn btn-success">
                                ğŸ“ ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    `;
                } else {
                    const facilitiesHTML = group.facilities.map(facility => `
                        <div class="facility-item facility-available">
                            <span class="facility-name">${facility}</span>
                            <div class="facility-status">
                                <span class="status-badge badge-pending">ì‚¬ìš© ê°€ëŠ¥</span>
                            </div>
                        </div>
                    `).join('');
                    
                    groupCard.innerHTML = `
                        <div class="group-header">
                            <div class="group-name">${group.name}</div>
                            <div class="group-status status-available">ì‹ ì²­ ê°€ëŠ¥</div>
                        </div>
                        <div class="facilities-list">
                            <strong>ì„¸ë¶€ ì‹œì„¤ í˜„í™©:</strong>
                            ${facilitiesHTML}
                        </div>
                        <div class="action-buttons">
                            <button onclick="window.open('https://forms.gle/YdxPsbDNCwyi1GNC9', '_blank')" 
                                    class="btn btn-success">
                                ğŸ“ ì‹ ì²­í•˜ê¸°
                            </button>
                        </div>
                    `;
                }
                
                container.appendChild(groupCard);
            });
            
            document.getElementById('lastUpdate').textContent = 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ';
        }
    </script>
</body>
</html>
